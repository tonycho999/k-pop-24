import news_api
import database
import naver_api
import re
import json
from datetime import datetime

# ì¹´í…Œê³ ë¦¬ë³„ 6ë‹¨ê³„ ì§ˆë¬¸ ì„¸íŠ¸ (ê¸°ì¡´ ë‚´ìš© ìœ ì§€)
PROMPT_VERSIONS = {
    "K-Pop": [
        "ë„ˆëŠ” 20ë…„ì°¨ ì—°ì˜ˆë¶€ ê¸°ìì•¼. ìµœê·¼ 24ì‹œê°„ ë‚´ í•œêµ­ ê¸°ì‚¬ì—ì„œ ì–¸ê¸‰ëŸ‰ì´ ê°€ì¥ ì••ë„ì ì¸ K-pop ê°€ìˆ˜(ê·¸ë£¹í¬í•¨) 10ëª…ì„ ì„ ì •í•´ ê°ê°ì˜ ì‹¬ì¸µ ê¸°ì‚¬ 1ê°œì”©ì„ ì˜ì–´ë¡œ 100ìì—ì„œ 300ìë¡œ ì¨ì¤˜. ê·¸ë¦¬ê³  í˜„ì‹œì  Top 10 ê³¡ ìˆœìœ„ë¥¼ ì•Œë ¤ì¤˜.",
        "ë„ˆëŠ” 20ë…„ì°¨ ì—°ì˜ˆë¶€ ê¸°ìì•¼. ìµœê·¼ 24ì‹œê°„ ë‚´ í•œêµ­ ê¸°ì‚¬ì—ì„œ í˜„ì¬ ì°¨íŠ¸ ì—­ì£¼í–‰ì´ë‚˜ ê¸‰ìƒìŠ¹ìœ¼ë¡œ í™”ì œì¸ K-pop ê°€ìˆ˜(ê·¸ë£¹í¬í•¨) 10ëª…ì„ ì„ ì •í•´ ê°ê°ì˜ ì‹¬ì¸µ ê¸°ì‚¬ 1ê°œì”©ì„ ì˜ì–´ë¡œ 100ìì—ì„œ 300ìë¡œ ì¨ì¤˜ ê·¸ë¦¬ê³  í˜„ì‹œì  Top 10 ê³¡ ìˆœìœ„ë¥¼ ì•Œë ¤ì¤˜..",
        "ë„ˆëŠ” 20ë…„ì°¨ ì—°ì˜ˆë¶€ ê¸°ìì•¼. ìµœê·¼ 24ì‹œê°„ ë‚´ í•œêµ­ ê¸°ì‚¬ì—ì„œ ë¹„í•˜ì¸ë“œ ë‰´ìŠ¤ë‚˜ ë…ì  ì¸í„°ë·°ë¡œ í™”ì œì¸ K-pop ê°€ìˆ˜(ê·¸ë£¹í¬í•¨) 10ëª…ì„ ì„ ì •í•´ ê°ê°ì˜ ì‹¬ì¸µ ê¸°ì‚¬ 1ê°œì”©ì„ ì˜ì–´ë¡œ 100ìì—ì„œ 300ìë¡œ ì¨ì¤˜. ê·¸ë¦¬ê³  í˜„ì‹œì  Top 10 ê³¡ ìˆœìœ„ë¥¼ ì•Œë ¤ì¤˜..",
        "ë„ˆëŠ” 20ë…„ì°¨ ì—°ì˜ˆë¶€ ê¸°ìì•¼. ìµœê·¼ 24ì‹œê°„ ë‚´ í•œêµ­ ê¸°ì‚¬ì—ì„œ ê¸€ë¡œë²Œ íŒ¬ë¤ ë° SNS ë°˜ì‘ì´ í­ë°œì ì¸ K-pop ê°€ìˆ˜(ê·¸ë£¹í¬í•¨) 10ëª…ì„ ì„ ì •í•´ ê°ê°ì˜ ì‹¬ì¸µ ê¸°ì‚¬ 1ê°œì”©ì„ ì˜ì–´ë¡œ 100ìì—ì„œ 300ìë¡œ ì¨ì¤˜. ê·¸ë¦¬ê³  í˜„ì‹œì  Top 10 ê³¡ ìˆœìœ„ë¥¼ ì•Œë ¤ì¤˜..",
        "ë„ˆëŠ” 20ë…„ì°¨ ì—°ì˜ˆë¶€ ê¸°ìì•¼. ìµœê·¼ 24ì‹œê°„ ë‚´ í•œêµ­ ê¸°ì‚¬ì—ì„œ ì—…ê³„ ë‚´ ëœ¨ê±°ìš´ ë…¼ìŸì´ë‚˜ ë°˜ì „ ì´ìŠˆì˜ ì£¼ì¸ê³µì¸ K-pop ê°€ìˆ˜(ê·¸ë£¹í¬í•¨) 10ëª…ì„ ì„ ì •í•´ ê°ê°ì˜ ì‹¬ì¸µ ê¸°ì‚¬ 1ê°œì”©ì„ ì˜ì–´ë¡œ 100ìì—ì„œ 300ìë¡œ ì¨ì¤˜. ê·¸ë¦¬ê³  í˜„ì‹œì  Top 10 ê³¡ ìˆœìœ„ë¥¼ ì•Œë ¤ì¤˜.",
        "ë„ˆëŠ” 20ë…„ì°¨ ì—°ì˜ˆë¶€ ê¸°ìì•¼. ìµœê·¼ 24ì‹œê°„ ë‚´ í•œêµ­ ê¸°ì‚¬ì—ì„œ ì»´ë°± ì˜ˆê³ ë‚˜ ëŒ€í˜• í”„ë¡œì íŠ¸ë¥¼ ì‹œì‘í•œ K-pop ê°€ìˆ˜(ê·¸ë£¹í¬í•¨) 10ëª…ì„ ì„ ì •í•´ ê°ê°ì˜ ì‹¬ì¸µ ê¸°ì‚¬ 1ê°œì”©ì„ ì˜ì–´ë¡œ 100ìì—ì„œ 300ìë¡œ ì¨ì¤˜. ê·¸ë¦¬ê³  í˜„ì‹œì  Top 10 ê³¡ ìˆœìœ„ë¥¼ ì•Œë ¤ì¤˜.."
    ],
    "K-Drama": [
        "ë„ˆëŠ” 20ë…„ì°¨ ì—°ì˜ˆë¶€ ê¸°ìì•¼. ìµœê·¼ 24ì‹œê°„ ë‚´ í•œêµ­ ê¸°ì‚¬ì—ì„œ í™”ì œì„± 1ìœ„ ë“œë¼ë§ˆì˜ ì£¼ì—° ë°°ìš° 10ëª…ì„ ì„ ì •í•´ ê°ê°ì˜ ì‹¬ì¸µ ê¸°ì‚¬ 1ê°œì”©ì„ ì˜ì–´ë¡œ 100ìì—ì„œ 300ìë¡œ ì¨ì¤˜. ê·¸ë¦¬ê³  í˜„ì‹œì  ë“œë¼ë§ˆ ìˆœìœ„ 1~10ìœ„ë¥¼ ì•Œë ¤ì¤˜.",
        "ë„ˆëŠ” 20ë…„ì°¨ ì—°ì˜ˆë¶€ ê¸°ìì•¼. ìµœê·¼ 24ì‹œê°„ ë‚´ í•œêµ­ ê¸°ì‚¬ì—ì„œ ë“œë¼ë§ˆ í•œ í¸ìœ¼ë¡œ ì¸ìƒì´ ë°”ë€ ë¼ì´ì§• ë°°ìš° 10ëª…ì„ ì„ ì •í•´ ê°ê°ì˜ ì‹¬ì¸µ ê¸°ì‚¬ 1ê°œì”©ì„ ì˜ì–´ë¡œ 100ìì—ì„œ 300ìë¡œ ì¨ì¤˜. ê·¸ë¦¬ê³  í˜„ì‹œì  ë“œë¼ë§ˆ ìˆœìœ„ 1~10ìœ„ë¥¼ ì•Œë ¤ì¤˜.",
        "ë„ˆëŠ” 20ë…„ì°¨ ì—°ì˜ˆë¶€ ê¸°ìì•¼. ìµœê·¼ 24ì‹œê°„ ë‚´ í•œêµ­ ê¸°ì‚¬ì—ì„œ ì´¬ì˜ í˜„ì¥ ë¹„í™”ë‚˜ ìºìŠ¤íŒ… ì†Œì‹ìœ¼ë¡œ í™”ì œì¸ ë°°ìš° 10ëª…ì„ ì„ ì •í•´ ê°ê°ì˜ ì‹¬ì¸µ ê¸°ì‚¬ 1ê°œì”©ì„ ì˜ì–´ë¡œ 100ìì—ì„œ 300ìë¡œ ì¨ì¤˜. ê·¸ë¦¬ê³  í˜„ì‹œì  ë“œë¼ë§ˆ ìˆœìœ„ 1~10ìœ„ë¥¼ ì•Œë ¤ì¤˜.",
        "ë„ˆëŠ” 20ë…„ì°¨ ì—°ì˜ˆë¶€ ê¸°ìì•¼. ìµœê·¼ 24ì‹œê°„ ë‚´ í•œêµ­ ê¸°ì‚¬ì—ì„œ ê¸€ë¡œë²Œ OTT ì°¨íŠ¸ë¥¼ íœ©ì“´ ë“œë¼ë§ˆì˜ ë°°ìš° 10ëª…ì„ ì„ ì •í•´ ê°ê°ì˜ ì‹¬ì¸µ ê¸°ì‚¬ 1ê°œì”©ì„ ì˜ì–´ë¡œ 100ìì—ì„œ 300ìë¡œ ì¨ì¤˜. ê·¸ë¦¬ê³  í˜„ì‹œì  ë“œë¼ë§ˆ ìˆœìœ„ 1~10ìœ„ë¥¼ ì•Œë ¤ì¤˜.",
        "ë„ˆëŠ” 20ë…„ì°¨ ì—°ì˜ˆë¶€ ê¸°ìì•¼. ìµœê·¼ 24ì‹œê°„ ë‚´ í•œêµ­ ê¸°ì‚¬ì—ì„œ ê²°ë§ ë…¼ë€ì´ë‚˜ ì¸í„°ë·°ë¡œ í™”ì œì¸ ë°°ìš° 10ëª…ì„ ì„ ì •í•´ ê°ê°ì˜ ì‹¬ì¸µ ê¸°ì‚¬ 1ê°œì”©ì„ ì˜ì–´ë¡œ 100ìì—ì„œ 300ìë¡œ ì¨ì¤˜. ê·¸ë¦¬ê³  í˜„ì‹œì  ë“œë¼ë§ˆ ìˆœìœ„ 1~10ìœ„ë¥¼ ì•Œë ¤ì¤˜.",
        "ë„ˆëŠ” 20ë…„ì°¨ ì—°ì˜ˆë¶€ ê¸°ìì•¼. ìµœê·¼ 24ì‹œê°„ ë‚´ í•œêµ­ ê¸°ì‚¬ì—ì„œ ì°¨ê¸°ì‘ì´ ê¸°ëŒ€ë˜ëŠ” 'ë¯¿ë³´ë°°' ë°°ìš° 10ëª…ì„ ì„ ì •í•´ ê°ê°ì˜ ì‹¬ì¸µ ê¸°ì‚¬ 1ê°œì”©ì„ ì˜ì–´ë¡œ 100ìì—ì„œ 300ìë¡œ ì¨ì¤˜. ê·¸ë¦¬ê³  í˜„ì‹œì  ë“œë¼ë§ˆ ìˆœìœ„ 1~10ìœ„ë¥¼ ì•Œë ¤ì¤˜."
    ],
    "K-Movie": [
        "ë„ˆëŠ” 20ë…„ì°¨ ì—°ì˜ˆë¶€ ê¸°ìì•¼. ìµœê·¼ 24ì‹œê°„ ë‚´ í•œêµ­ ê¸°ì‚¬ì—ì„œ ë°•ìŠ¤ì˜¤í”¼ìŠ¤ 1ìœ„ ì˜í™”ì˜ í•µì‹¬ ë°°ìš°ë‚˜ ê°ë… 10ëª…ì„ ì„ ì •í•´ ê°ê°ì˜ ì‹¬ì¸µ ê¸°ì‚¬ 1ê°œì”©ì„ ì˜ì–´ë¡œ 100ìì—ì„œ 300ìë¡œ ì¨ì¤˜. ê·¸ë¦¬ê³  í˜„ì‹œì  ì˜í™” ìˆœìœ„ 1~10ìœ„ë¥¼ ì•Œë ¤ì¤˜.",
        "ë„ˆëŠ” 20ë…„ì°¨ ì—°ì˜ˆë¶€ ê¸°ìì•¼. ìµœê·¼ 24ì‹œê°„ ë‚´ í•œêµ­ ê¸°ì‚¬ì—ì„œ ë…ë¦½ì˜í™”ë‚˜ ì €ì˜ˆì‚° ì˜í™”ì—ì„œ ë°œêµ´ëœ ì²œì¬ ì˜í™”ì¸ 10ëª…ì„ ì„ ì •í•´ ê°ê°ì˜ ì‹¬ì¸µ ê¸°ì‚¬ 1ê°œì”©ì„ ì˜ì–´ë¡œ 100ìì—ì„œ 300ìë¡œ ì¨ì¤˜. ê·¸ë¦¬ê³  í˜„ì‹œì  ì˜í™” ìˆœìœ„ 1~10ìœ„ë¥¼ ì•Œë ¤ì¤˜.",
        "ë„ˆëŠ” 20ë…„ì°¨ ì—°ì˜ˆë¶€ ê¸°ìì•¼. ìµœê·¼ 24ì‹œê°„ ë‚´ í•œêµ­ ê¸°ì‚¬ì—ì„œ ë…íŠ¹í•œ ì—°ì¶œì´ë‚˜ ì œì‘ ë¹„í™”ë¡œ í™”ì œì¸ ì˜í™”ì¸ 10ëª…ì„ ì„ ì •í•´ ê°ê°ì˜ ì‹¬ì¸µ ê¸°ì‚¬ 1ê°œì”©ì„ ì˜ì–´ë¡œ 100ìì—ì„œ 300ìë¡œ ì¨ì¤˜. ê·¸ë¦¬ê³  í˜„ì‹œì  ì˜í™” ìˆœìœ„ 1~10ìœ„ë¥¼ ì•Œë ¤ì¤˜.",
        "ë„ˆëŠ” 20ë…„ì°¨ ì—°ì˜ˆë¶€ ê¸°ìì•¼. ìµœê·¼ 24ì‹œê°„ ë‚´ í•œêµ­ ê¸°ì‚¬ì—ì„œ í•´ì™¸ ì‹œìƒì‹ ìˆ˜ìƒì´ë‚˜ í•´ì™¸ ì§„ì¶œë¡œ í™”ì œì¸ ì˜í™”ì¸ 10ëª…ì„ ì„ ì •í•´ ê°ê°ì˜ ì‹¬ì¸µ ê¸°ì‚¬ 1ê°œì”©ì„ ì˜ì–´ë¡œ 100ìì—ì„œ 300ìë¡œ ì¨ì¤˜. ê·¸ë¦¬ê³  í˜„ì‹œì  ì˜í™” ìˆœìœ„ 1~10ìœ„ë¥¼ ì•Œë ¤ì¤˜.",
        "ë„ˆëŠ” 20ë…„ì°¨ ì—°ì˜ˆë¶€ ê¸°ìì•¼. ìµœê·¼ 24ì‹œê°„ ë‚´ í•œêµ­ ê¸°ì‚¬ì—ì„œ ì˜í™”ê³„ ì´ìŠˆë‚˜ ë…¼ìŸì˜ ì¤‘ì‹¬ì¸ ì˜í™”ì¸ 10ëª…ì„ ì„ ì •í•´ ê°ê°ì˜ ì‹¬ì¸µ ê¸°ì‚¬ 1ê°œì”©ì„ ì˜ì–´ë¡œ 100ìì—ì„œ 300ìë¡œ ì¨ì¤˜. ê·¸ë¦¬ê³  í˜„ì‹œì  ì˜í™” ìˆœìœ„ 1~10ìœ„ë¥¼ ì•Œë ¤ì¤˜.",
        "ë„ˆëŠ” 20ë…„ì°¨ ì—°ì˜ˆë¶€ ê¸°ìì•¼. ìµœê·¼ 24ì‹œê°„ ë‚´ í•œêµ­ ê¸°ì‚¬ì—ì„œ ëŒ€ì‘ ê°œë´‰ì„ ì•ë‘ê³  í™ë³´ ì¤‘ì¸ í•«í•œ ì˜í™”ì¸ 10ëª…ì„ ì„ ì •í•´ ê°ê°ì˜ ì‹¬ì¸µ ê¸°ì‚¬ 1ê°œì”©ì„ ì˜ì–´ë¡œ 100ìì—ì„œ 300ìë¡œ ì¨ì¤˜. ê·¸ë¦¬ê³  í˜„ì‹œì  ì˜í™” ìˆœìœ„ 1~10ìœ„ë¥¼ ì•Œë ¤ì¤˜."
    ],
    "K-Entertain": [
        "ë„ˆëŠ” 20ë…„ì°¨ ì—°ì˜ˆë¶€ ê¸°ìì•¼. ìµœê·¼ 24ì‹œê°„ ë‚´ í•œêµ­ ê¸°ì‚¬ì—ì„œ ì‹œì²­ë¥  1ìœ„ ì˜ˆëŠ¥ì˜ ë©”ì¸ ì¶œì—°ì§„ 10ëª…ì„ ì„ ì •í•´ ê°ê°ì˜ ì‹¬ì¸µ ê¸°ì‚¬ 1ê°œì”©ì„ ì˜ì–´ë¡œ 100ìì—ì„œ 300ìë¡œ ì¨ì¤˜. ê·¸ë¦¬ê³  í˜„ì‹œì  ì˜ˆëŠ¥ ìˆœìœ„ 1~10ìœ„ë¥¼ ì•Œë ¤ì¤˜.",
        "ë„ˆëŠ” 20ë…„ì°¨ ì—°ì˜ˆë¶€ ê¸°ìì•¼. ìµœê·¼ 24ì‹œê°„ ë‚´ í•œêµ­ ê¸°ì‚¬ì—ì„œ ìœ íŠœë¸Œë‚˜ OTT ì˜ˆëŠ¥ì—ì„œ ì œ2ì˜ ì „ì„±ê¸°ë¥¼ ë§ì€ ì˜ˆëŠ¥ì¸ 10ëª…ì„ ì„ ì •í•´ ê°ê°ì˜ ì‹¬ì¸µ ê¸°ì‚¬ 1ê°œì”©ì„ ì˜ì–´ë¡œ 100ìì—ì„œ 300ìë¡œ ì¨ì¤˜. ê·¸ë¦¬ê³  í˜„ì‹œì  ì˜ˆëŠ¥ ìˆœìœ„ 1~10ìœ„ë¥¼ ì•Œë ¤ì¤˜.",
        "ë„ˆëŠ” 20ë…„ì°¨ ì—°ì˜ˆë¶€ ê¸°ìì•¼. ìµœê·¼ 24ì‹œê°„ ë‚´ í•œêµ­ ê¸°ì‚¬ì—ì„œ ì¶œì—°ì§„ ê°„ì˜ ì¼€ë¯¸ë¡œ í™”ì œì¸ ì˜ˆëŠ¥ì¸ 10ëª…ì„ ì„ ì •í•´ ê°ê°ì˜ ì‹¬ì¸µ ê¸°ì‚¬ 1ê°œì”©ì„ ì˜ì–´ë¡œ 100ìì—ì„œ 300ìë¡œ ì¨ì¤˜. ê·¸ë¦¬ê³  í˜„ì‹œì  ì˜ˆëŠ¥ ìˆœìœ„ 1~10ìœ„ë¥¼ ì•Œë ¤ì¤˜.",
        "ë„ˆëŠ” 20ë…„ì°¨ ì—°ì˜ˆë¶€ ê¸°ìì•¼. ìµœê·¼ 24ì‹œê°„ ë‚´ í•œêµ­ ê¸°ì‚¬ì—ì„œ í•´ì™¸ íŒ¬ë¤ì´ ê°•ë ¥í•œ ê¸€ë¡œë²Œ ì˜ˆëŠ¥ì¸ 10ëª…ì„ ì„ ì •í•´ ê°ê°ì˜ ì‹¬ì¸µ ê¸°ì‚¬ 1ê°œì”©ì„ ì˜ì–´ë¡œ 100ìì—ì„œ 300ìë¡œ ì¨ì¤˜. ê·¸ë¦¬ê³  í˜„ì‹œì  ì˜ˆëŠ¥ ìˆœìœ„ 1~10ìœ„ë¥¼ ì•Œë ¤ì¤˜.",
        "ë„ˆëŠ” 20ë…„ì°¨ ì—°ì˜ˆë¶€ ê¸°ìì•¼. ìµœê·¼ 24ì‹œê°„ ë‚´ í•œêµ­ ê¸°ì‚¬ì—ì„œ íƒœë„ ë…¼ë€ì´ë‚˜ ì„­ì™¸ ì´ìŠˆë¡œ í™”ì œì¸ ì˜ˆëŠ¥ì¸ 10ëª…ì„ ì„ ì •í•´ ê°ê°ì˜ ì‹¬ì¸µ ê¸°ì‚¬ 1ê°œì”©ì„ ì˜ì–´ë¡œ 100ìì—ì„œ 300ìë¡œ ì¨ì¤˜. ê·¸ë¦¬ê³  í˜„ì‹œì  ì˜ˆëŠ¥ ìˆœìœ„ 1~10ìœ„ë¥¼ ì•Œë ¤ì¤˜.",
        "ë„ˆëŠ” 20ë…„ì°¨ ì—°ì˜ˆë¶€ ê¸°ìì•¼. ìµœê·¼ 24ì‹œê°„ ë‚´ í•œêµ­ ê¸°ì‚¬ì—ì„œ ìƒˆ ì‹œì¦Œ ë³µê·€ë‚˜ ì»´ë°±ìœ¼ë¡œ í™”ì œì¸ ì˜ˆëŠ¥ì¸ 10ëª…ì„ ì„ ì •í•´ ê°ê°ì˜ ì‹¬ì¸µ ê¸°ì‚¬ 1ê°œì”©ì„ ì˜ì–´ë¡œ 100ìì—ì„œ 300ìë¡œ ì¨ì¤˜. ê·¸ë¦¬ê³  í˜„ì‹œì  ì˜ˆëŠ¥ ìˆœìœ„ 1~10ìœ„ë¥¼ ì•Œë ¤ì¤˜."
    ],
    "K-Culture": [
        "ë„ˆëŠ” 20ë…„ì°¨ ì—°ì˜ˆë¶€ ê¸°ìì•¼. ìµœê·¼ 24ì‹œê°„ ë‚´ í•œêµ­ ê¸°ì‚¬ì—ì„œ ê°€ì¥ í•«í•œ ì „ì‹œë‚˜ íŒì—…ìŠ¤í† ì–´ë¥¼ ê¸°íší•œ ë¬¸í™”ì¸ 10ëª…ì„ ì„ ì •í•´ ê°ê°ì˜ ì‹¬ì¸µ ê¸°ì‚¬ 1ê°œì”©ì„ ì˜ì–´ë¡œ 100ìì—ì„œ 300ìë¡œ ì¨ì¤˜. ê·¸ë¦¬ê³  í˜„ì‹œì  ë¬¸í™” í•«í”½ 1~10ìœ„ë¥¼ ì•Œë ¤ì¤˜.",
        "ë„ˆëŠ” 20ë…„ì°¨ ì—°ì˜ˆë¶€ ê¸°ìì•¼. ìµœê·¼ 24ì‹œê°„ ë‚´ í•œêµ­ ê¸°ì‚¬ì—ì„œ MZì„¸ëŒ€ íŠ¸ë Œë“œë¥¼ ì„ ë„í•˜ëŠ” ì˜ˆìˆ ê°€ë‚˜ ì¸ë¬¼ 10ëª…ì„ ì„ ì •í•´ ê°ê°ì˜ ì‹¬ì¸µ ê¸°ì‚¬ 1ê°œì”©ì„ ì˜ì–´ë¡œ 100ìì—ì„œ 300ìë¡œ ì¨ì¤˜. ê·¸ë¦¬ê³  í˜„ì‹œì  ë¬¸í™” í•«í”½ 1~10ìœ„ë¥¼ ì•Œë ¤ì¤˜.",
        "ë„ˆëŠ” 20ë…„ì°¨ ì—°ì˜ˆë¶€ ê¸°ìì•¼. ìµœê·¼ 24ì‹œê°„ ë‚´ í•œêµ­ ê¸°ì‚¬ì—ì„œ ì „í†µì„ í™í•˜ê²Œ ì¬í•´ì„í•œ ì¥ì¸ì´ë‚˜ ì¸ë¬¼ 10ëª…ì„ ì„ ì •í•´ ê°ê°ì˜ ì‹¬ì¸µ ê¸°ì‚¬ 1ê°œì”©ì„ ì˜ì–´ë¡œ 100ìì—ì„œ 300ìë¡œ ì¨ì¤˜. ê·¸ë¦¬ê³  í˜„ì‹œì  ë¬¸í™” í•«í”½ 1~10ìœ„ë¥¼ ì•Œë ¤ì¤˜.",
        "ë„ˆëŠ” 20ë…„ì°¨ ì—°ì˜ˆë¶€ ê¸°ìì•¼. ìµœê·¼ 24ì‹œê°„ ë‚´ í•œêµ­ ê¸°ì‚¬ì—ì„œ K-í‘¸ë“œë‚˜ í•œêµ­ ë¬¸í™”ë¥¼ ì„¸ê³„ì— ì•Œë¦° ì¸ë¬¼ 10ëª…ì„ ì„ ì •í•´ ê°ê°ì˜ ì‹¬ì¸µ ê¸°ì‚¬ 1ê°œì”©ì„ ì˜ì–´ë¡œ 100ìì—ì„œ 300ìë¡œ ì¨ì¤˜. ê·¸ë¦¬ê³  í˜„ì‹œì  ë¬¸í™” í•«í”½ 1~10ìœ„ë¥¼ ì•Œë ¤ì¤˜.",
        "ë„ˆëŠ” 20ë…„ì°¨ ì—°ì˜ˆë¶€ ê¸°ìì•¼. ìµœê·¼ 24ì‹œê°„ ë‚´ í•œêµ­ ê¸°ì‚¬ì—ì„œ ê³µìµì  ë¬¸í™” í™œë™ì´ë‚˜ ì§€ì—­ ì‚´ë¦¬ê¸°ë¡œ í™”ì œì¸ ì¸ë¬¼ 10ëª…ì„ ì„ ì •í•´ ê°ê°ì˜ ì‹¬ì¸µ ê¸°ì‚¬ 1ê°œì”©ì„ ì˜ì–´ë¡œ 100ìì—ì„œ 300ìë¡œ ì¨ì¤˜. ê·¸ë¦¬ê³  í˜„ì‹œì  ë¬¸í™” í•«í”½ 1~10ìœ„ë¥¼ ì•Œë ¤ì¤˜.",
        "ë„ˆëŠ” 20ë…„ì°¨ ì—°ì˜ˆë¶€ ê¸°ìì•¼. ìµœê·¼ 24ì‹œê°„ ë‚´ í•œêµ­ ê¸°ì‚¬ì—ì„œ ëœë“œë§ˆí¬ ê±´ë¦½ì´ë‚˜ ëŒ€í˜• ì¶•ì œë¥¼ ì´ë„ëŠ” ì¸ë¬¼ 10ëª…ì„ ì„ ì •í•´ ê°ê°ì˜ ì‹¬ì¸µ ê¸°ì‚¬ 1ê°œì”©ì„ ì˜ì–´ë¡œ 100ìì—ì„œ 300ìë¡œ ì¨ì¤˜. ê·¸ë¦¬ê³  í˜„ì‹œì  ë¬¸í™” í•«í”½ 1~10ìœ„ë¥¼ ì•Œë ¤ì¤˜."
    ]
}

def parse_rankings(raw_rankings_text, category):
    """í…ìŠ¤íŠ¸ í˜•íƒœì˜ ë­í‚¹ì„ DB ê°ì²´ ë¦¬ìŠ¤íŠ¸ë¡œ ë³€í™˜"""
    if not raw_rankings_text: return []
    parsed = []
    lines = raw_rankings_text.replace('*', '').strip().split('\n')
    for i, line in enumerate(lines):
        if i >= 10: break
        try:
            line = re.sub(r'\[\d+\]', '', line).strip()
            title = re.sub(r'^\d+[\.\)\s-]*', '', line).strip()
            if title:
                parsed.append({
                    # âœ… AIê°€ ì¤€ í…ìŠ¤íŠ¸ë³´ë‹¤ ì¸ìë¡œ ë°›ì€ categoryë¥¼ ìš°ì„  ì‚¬ìš©
                    "category": category,
                    "rank": i + 1,
                    "title_en": title,
                    "title_kr": title,
                    "score": 100 - (i * 5),
                    "created_at": datetime.now().isoformat()
                })
        except: continue
    return parsed

def run_category_process(category, run_count):
    print(f"\nğŸš€ [Processing Start] {category} (Run #{run_count})")

    v_idx = run_count % 6
    task = PROMPT_VERSIONS[category][v_idx]

    final_prompt = f"""
    ì‹¤ì‹œê°„ ê²€ìƒ‰ì„ ì‚¬ìš©í•˜ì—¬ ë‹¤ìŒ ê³¼ì œë¥¼ ìˆ˜í–‰í•˜ë¼: {task}
    
    ê²°ê³¼ë¬¼ì€ ë°˜ë“œì‹œ ì•„ë˜ íƒœê·¸ë¥¼ ì‚¬ìš©í•˜ì—¬ êµ¬ë¶„í•˜ë¼. (ë‹¤ë¥¸ ì„¤ëª… ê¸ˆì§€)
    
    ##TARGET_KR## í•œêµ­ì–´ ì´ë¦„
    ##TARGET_EN## English Name
    ##HEADLINE## ì˜ë¬¸ ê¸°ì‚¬ ì œëª©
    ##CONTENT## ì˜ë¬¸ ê¸°ì‚¬ ë³¸ë¬¸
    ##RANKINGS##
    1. ìˆœìœ„ ë°ì´í„° 1
    ... 10ìœ„ê¹Œì§€ ì‘ì„±
    """

    # 1. AI í˜¸ì¶œ
    data, raw_text = news_api.ask_news_ai(final_prompt)

    # 2. íŒŒì‹± ì‹¤íŒ¨ ì‹œ ì—ëŸ¬ ë¡œê·¸ ê¸°ë¡
    if not data or not data.get('headline'):
        print(f"âŒ {category} ì¶”ì¶œ ì‹¤íŒ¨! ì›ë¬¸ì„ DB 'error_logs'ì— ê¸°ë¡í•©ë‹ˆë‹¤.")
        error_data = {
            "category": category,
            "run_count": run_count,
            "raw_response": raw_text if raw_text else "NO RESPONSE FROM AI",
            "error_message": "Tag parsing failed: Critical tags (HEADLINE/CONTENT) missing."
        }
        database.save_error_log(error_data)
        return

    # 3. ë°ì´í„° ì €ì¥ í”„ë¡œì„¸ìŠ¤
    try:
        # âœ… search_archive ê¸°ë¡
        archive_data = {
            "category": category,
            "query": task,
            "raw_result": raw_text,
            "run_count": run_count,
            "created_at": datetime.now().isoformat()
        }
        database.save_search_archive(archive_data)
        print(f"ğŸ“‚ [Archive] AI ê²€ìƒ‰ ì›ë¬¸ ì €ì¥ ì™„ë£Œ.")

        # ë­í‚¹ ë°ì´í„° ì²˜ë¦¬
        raw_rankings = data.get('raw_rankings', '')
        # âœ… íŒŒì‹± í•¨ìˆ˜ì— í˜„ì¬ ì§„í–‰ ì¤‘ì¸ categoryë¥¼ ëª…ì‹œì ìœ¼ë¡œ ì „ë‹¬
        clean_rankings = parse_rankings(raw_rankings, category)
        if clean_rankings:
            database.save_rankings_to_db(clean_rankings)

        # íƒ€ê²Ÿ ì •ë³´ ë° ì´ë¯¸ì§€ ìˆ˜ì§‘
        target_kr = data.get("target_kr", "K-Star").strip()
        target_en = data.get("target_en", "K-Star").strip()
        print(f"ğŸ“¸ '{target_kr}' ê´€ë ¨ ì´ë¯¸ì§€ ìˆ˜ì§‘ ì¤‘...")
        final_image = naver_api.get_target_image(target_kr)

        # ë‰´ìŠ¤ ê¸°ì‚¬ ê°ì²´ ìƒì„±
        news_items = [{
            # ğŸš¨ [ìˆ˜ì • í•µì‹¬] AIê°€ ì¤€ data.get("category")ë¥¼ ì“°ì§€ ì•Šê³  
            # ğŸš¨ í•¨ìˆ˜ ì¸ìë¡œ ë„˜ì–´ì˜¨ categoryë¥¼ ê°•ì œë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤.
            "category": category, 
            "keyword": target_en,
            "title": data.get("headline", "Breaking News"),
            "summary": data.get("content", ""),
            "image_url": final_image,
            "score": 100,
            "created_at": datetime.now().isoformat(),
            "likes": 0
        }]
        
        database.save_news_to_live(news_items)
        print(f"ğŸ‰ ì„±ê³µ: [{category}] {target_en} ê¸°ì‚¬ ë°œí–‰ ì™„ë£Œ.")

    except Exception as e:
        print(f"ğŸš¨ ì €ì¥ ê³¼ì • ì¤‘ ì˜¤ë¥˜ ë°œìƒ ({category}): {e}")
        database.save_error_log({
            "category": category,
            "run_count": run_count,
            "raw_response": str(data),
            "error_message": f"Processing Exception: {str(e)}"
        })
